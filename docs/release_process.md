# Minerva リリースプロセス

このドキュメントでは、Minervaプロジェクトのリリースプロセスと、バージョン管理の方法について説明します。

## バージョン管理の基本原則

Minervaプロジェクトでは、以下の原則に基づいてバージョン管理を行います：

1. **単一のソース**: バージョン番号は `src/minerva/__version__.py` ファイルで一元管理されています
2. **セマンティックバージョニング**: バージョン番号は `X.Y.Z` の形式（メジャー.マイナー.パッチ）で管理されます
3. **自動更新**: バージョン番号は `python-semantic-release` によって自動的に更新されます

### セマンティックバージョニングのルール

- **メジャーバージョン (X)**: 後方互換性のない変更（APIの変更など）
- **マイナーバージョン (Y)**: 後方互換性のある機能追加（新しいツールの追加など）
- **パッチバージョン (Z)**: バグ修正や軽微な変更

## コミットメッセージの規約

バージョン番号の自動更新は、[Conventional Commits](https://www.conventionalcommits.org/)の規約に基づいて行われます：

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### コミットタイプとバージョン更新の関係

| コミットタイプ | バージョン更新 | 説明 |
|--------------|--------------|------|
| `feat` | マイナー（Y） | 新機能の追加 |
| `feat!` | メジャー（X） | 後方互換性のない新機能 |
| `fix` | パッチ（Z） | バグ修正 |
| `docs` | なし | ドキュメントのみの変更 |
| `style` | なし | コードスタイルの変更（フォーマットなど） |
| `refactor` | なし | リファクタリング（機能追加やバグ修正を伴わない） |
| `perf` | パッチ（Z） | パフォーマンス向上のための変更 |
| `test` | なし | テストの追加・修正 |
| `build` | なし | ビルドシステムの変更 |
| `ci` | なし | CI設定の変更 |
| `chore` | なし | その他の変更 |

**注意**: コミットメッセージの本文や脚注に `BREAKING CHANGE:` を含めると、メジャーバージョンが更新されます。

## 自動リリースプロセス

Minervaプロジェクトでは、GitHub Actionsを使用して自動的にリリースを作成します：

1. 開発者が変更を `main` ブランチにプッシュします
2. GitHub Actionsが自動的に起動し、以下の処理を行います：
   - コミットメッセージを解析して適切なバージョン更新を決定
   - `__version__.py` と `pyproject.toml` のバージョン番号を更新
   - CHANGELOGを更新
   - 更新を含む新しいコミットを作成
   - 新しいバージョンのタグを作成
   - GitHubリリースを作成

## 手動リリースプロセス

自動リリースプロセスが何らかの理由で機能しない場合、以下の手順で手動リリースを行うことができます：

1. 最新の `main` ブランチを取得: `git checkout main && git pull`
2. 依存関係をインストール: `uv add --dev python-semantic-release`
3. バージョン更新を実行: `uv run semantic-release version`
4. 変更をプッシュ: `git push && git push --tags`

## バージョンの一貫性チェック

バージョン番号の一貫性を確認するには、以下のコマンドを実行します：

```bash
python scripts/check_version.py
```

このスクリプトは以下の場所のバージョン番号が一致しているかを確認します：
- `src/minerva/__version__.py`
- `pyproject.toml`

## リリース後の確認

新しいリリースが作成されたら、以下の点を確認してください：

1. GitHubのリリースページに新しいリリースが表示されていること
2. CHANGELOGが更新されていること
3. バージョン番号が正しく更新されていること

## トラブルシューティング

### バージョン不一致の修正

バージョン番号が一致していない場合は、以下の手順で修正します：

1. `src/minerva/__version__.py` のバージョン番号を修正
2. `pyproject.toml` のバージョン番号を修正
3. 変更をコミット: `git commit -m "chore: fix version mismatch"`
4. 変更をプッシュ: `git push`
